{% liquid
  assign page_faqs = blank

  if template.name == 'page' and page
    assign page_faqs = page.metafields.custom.faqs.value
  elsif template contains 'collection'
    assign page_faqs = collection.metafields.custom.faqs.value
  elsif template contains 'article'
    assign page_faqs = article.metafields.custom.faqs.value
  endif

  assign section_faqs = section.settings.faqs
  assign global_faqs = settings.custom.global_faqs.value
  assign faqs = section_faqs | default: page_faqs | default: global_faqs
%}

{% if faqs != blank %}
<div class="faq-section page-width">
  <h2 class="faq-title">{{ section.settings.heading }}</h2>

  <div class="faq-accordion">
    {% for faq in faqs %}
      <details class="faq-item">
        <summary class="faq-question">
          {{ faq.question }}
          <span class="icon-caret"></span>
        </summary>
        <div class="faq-answer rte">
          {{ faq.answer | metafield_tag }}
        </div>
      </details>
    {% endfor %}
  </div>
</div>

{%- comment -%} SEO FAQ Schema {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in faqs %}
    {
      "@type": "Question",
      "name": {{ faq.question | json }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ faq.answer | metafield_text | json }}
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}

{% schema %}
{
  "name": "Dynamic FAQ (SEO)",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "metaobject_list",
      "id": "faqs",
      "metaobject_type": "faq",
      "label": "FAQs from metaobject",
      "info": "Select FAQs to display. Overrides global FAQs if set. For homepage, select your FAQ metaobject entries here."
    }
  ],
  "presets": [
    {
      "name": "Dynamic FAQ (SEO)"
    }
  ]
}
{% endschema %}
